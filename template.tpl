___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Conseno CMP (with Consent Mode)",
  "categories": [
    "UTILITY"
  ],
  "brand": {
    "id": "github.com_Conseno",
    "displayName": "Conseno",
    "thumbnail": "data:image/jpeg;base64,/9j/4QC8RXhpZgAASUkqAAgAAAAGABIBAwABAAAAAQAAABoBBQABAAAAVgAAABsBBQABAAAAXgAAACgBAwABAAAAAgAAABMCAwABAAAAAQAAAGmHBAABAAAAZgAAAAAAAABgAAAAAQAAAGAAAAABAAAABgAAkAcABAAAADAyMTABkQcABAAAAAECAwAAoAcABAAAADAxMDABoAMAAQAAAP//AAACoAQAAQAAAAQBAAADoAQAAQAAAAQBAAAAAAAA/+EOAGh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8APD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDIyLTAyLTAzPC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmEwZjFkNmU0LTIxZjItNDJiMy05NTkyLWNmZDBkZmExMTIxNTwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5Db25zZW5vIEZhdmljb24gIDI2MCDDlyAyNjAgcHg8L3JkZjpsaT4KICAgPC9yZGY6QWx0PgogIDwvZGM6dGl0bGU+CiA8L3JkZjpEZXNjcmlwdGlvbj4KCiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0nJwogIHhtbG5zOnBkZj0naHR0cDovL25zLmFkb2JlLmNvbS9wZGYvMS4zLyc+CiAgPHBkZjpBdXRob3I+UmFjaGVsIFB1dXN0YTwvcGRmOkF1dGhvcj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wPSdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvJz4KICA8eG1wOkNyZWF0b3JUb29sPkNhbnZhPC94bXA6Q3JlYXRvclRvb2w+CiA8L3JkZjpEZXNjcmlwdGlvbj4KPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg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"
  },
  "description": "Conseno is a consent management (CMP) and privacy-friendly analytics platform that helps you achieve legal compliance without leaving your marketing team in the dark. Learn more: https://conseno.com",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "GROUP",
    "name": "consenoInstallationMethodGroup",
    "displayName": "Installation method for Conseno",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "RADIO",
        "name": "installationMethodRadio",
        "displayName": "Choose your preferred installation method for Conseno:",
        "radioItems": [
          {
            "value": "html",
            "displayValue": "I have already installed Conseno directly in the head section of my website\u0027s HTML code above the Google Tag Manager script",
            "help": "If you choose this installation option, you are required to manually install Conseno\u0027s script in the head section of your website, before the Google Tag Manager code. You can find installation instructions and the advantages of this option in the official Conseno documentation. \u003cbr\u003e\u003cbr\u003eHowever, if you\u0027d like to enable Google Consent Mode while Conseno is installed directly in the head section of my website\u0027s HTML, it\u0027s still recommended to enable Google Consent Mode in this tag below via GTM."
          },
          {
            "value": "gtm",
            "displayValue": "I would like to install Conseno via Google Tag Manager",
            "help": "If you choose this option, Conseno will be installed on your website via Google Tag Manager. If you\u0027d like to enable Google Consent Mode with Conseno, please enable it in this tag below.",
            "subParams": [
              {
                "type": "TEXT",
                "name": "conseno_id",
                "displayName": "Conseno ID",
                "simpleValueType": true,
                "notSetText": "You need to enter the Conseno ID to install Conseno on your website via Google Tag Manager.",
                "help": "If you\u0027re logged into your Conseno account on conseno.com, navigate to the drop-down menu in the header to select the site where you want to install Conseno. If you\u0027ve made your selection, look to the top right corner of the screen. You\u0027ll find a short text starting with \"C-\" and formatted as \u003cstrong\u003eC-XXXXXXX\u003c/strong\u003e. This is your Conseno ID, which you should enter into the field provided below.",
                "valueValidators": [
                  {
                    "type": "NON_EMPTY",
                    "errorMessage": "",
                    "enablingConditions": []
                  }
                ],
                "valueHint": "C-XXXXXXX"
              },
              {
                "type": "SELECT",
                "name": "consentBannerLanguage",
                "displayName": "Consent banner language",
                "selectItems": [
                  {
                    "value": "document",
                    "displayValue": "Set language automatically (HTML language)"
                  },
                  {
                    "value": "browser",
                    "displayValue": "Set language automatically (browser language)"
                  },
                  {
                    "value": "variable",
                    "displayValue": "Set language by GTM variable"
                  }
                ],
                "simpleValueType": true,
                "defaultValue": "document",
                "help": "If you choose the \"Set language automatically (HTML language)\" option, your consent banner language will be automatically selected based on the \u003cstrong\u003ehtml lang\u003c/strong\u003e value of your website. If you choose the \"Set language automatically (browser language)\" option, your consent banner language will be automatically selected based on the visitor\u0027s browser language. If you choose \"Set language by GTM variable,\" you can set a static or dynamic value for your consent banner language yourself via GTM."
              },
              {
                "type": "TEXT",
                "name": "setLanguageByGtmVariable",
                "displayName": "Set your consent banner language",
                "simpleValueType": true,
                "enablingConditions": [
                  {
                    "paramName": "consentBannerLanguage",
                    "paramValue": "variable",
                    "type": "EQUALS"
                  }
                ],
                "help": "To ensure it works properly, you need to enter either a static or dynamic (via GTM variable) \u003cstrong\u003etwo-letter \u003ca href\u003d\"https://www.loc.gov/standards/iso639-2/php/code_list.php\"\u003eISO 639-1\u003c/a\u003e language code\u003c/strong\u003e below. Additionally, make sure you have configured all selected languages in your Conseno account.",
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  },
                  {
                    "type": "STRING_LENGTH",
                    "args": [
                      2,
                      2
                    ]
                  }
                ],
                "valueHint": "en"
              }
            ]
          }
        ],
        "simpleValueType": true,
        "defaultValue": "html"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "GoogleConsentModeGroup",
    "displayName": "Google Consent Mode for Conseno",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "EnableGoogleConsentMode",
        "checkboxText": "Enable Google Consent Mode",
        "simpleValueType": true,
        "defaultValue": true,
        "displayName": "Choose to either enable or disable Google Consent Mode V2:",
        "help": "Enable Google Consent Mode V2 if one or more of your tags in GTM rely on Google Consent Mode. If this box is checked, Google Consent Mode will be enabled, and Conseno will automatically take into account your visitors\u0027 consent and either activate or block these tags. If this box is unchecked, Google Consent Mode will be disabled.",
        "alwaysInSummary": true
      },
      {
        "type": "TEXT",
        "name": "GoogleConsentModeRegions",
        "displayName": "Choose your preferred regions for Google Consent Mode:",
        "simpleValueType": true,
        "defaultValue": "all",
        "enablingConditions": [
          {
            "paramName": "EnableGoogleConsentMode",
            "paramValue": true,
            "type": "EQUALS"
          }
        ],
        "help": "Apply this setting to users from the specified \u003ca href\u003d\"https://en.wikipedia.org/wiki/ISO_3166-2\"\u003eregions\u003c/a\u003e (provide a comma-separated list). If you enter \u003cstrong\u003eall\u003c/strong\u003e, the setting will apply to all users. If you include \u003cstrong\u003eeea\u003c/strong\u003e in the list, the tag will automatically cover all regions within the European Economic Area as geographical targets for this command.",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "SELECT",
        "name": "GoogleConsentModeDefaultState",
        "displayName": "Choose the default consent state for Google Consent Mode:",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "automatic",
            "displayValue": "Set the default consent state automatically"
          },
          {
            "value": "manual",
            "displayValue": "Set the default consent state via GTM"
          }
        ],
        "simpleValueType": true,
        "subParams": [],
        "enablingConditions": [
          {
            "paramName": "EnableGoogleConsentMode",
            "paramValue": true,
            "type": "EQUALS"
          }
        ],
        "defaultValue": "automatic",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "setAutomaticallyLabel",
        "displayName": "\u003cstrong\u003eClarification:\u003c/strong\u003e if you choose the \"Set the default consent state automatically\" option, the default consent state signals will be \u0027denied\u0027 by default. For more information about this option, please refer to the official Conseno documentation.",
        "enablingConditions": [
          {
            "paramName": "GoogleConsentModeDefaultState",
            "paramValue": "automatic",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "GROUP",
        "name": "setViaGTMGroup",
        "displayName": "Set the default consent state parameter values via GTM",
        "groupStyle": "ZIPPY_OPEN",
        "subParams": [
          {
            "type": "GROUP",
            "name": "required",
            "displayName": "Required parameters for Google Consent Mode",
            "groupStyle": "NO_ZIPPY",
            "subParams": [
              {
                "type": "SELECT",
                "name": "ad_storage",
                "displayName": "ad_storage",
                "macrosInSelect": true,
                "selectItems": [
                  {
                    "value": "granted",
                    "displayValue": "granted"
                  },
                  {
                    "value": "denied",
                    "displayValue": "denied"
                  },
                  {
                    "value": "notset",
                    "displayValue": "Not set"
                  }
                ],
                "simpleValueType": true,
                "defaultValue": "denied",
                "help": "If set to \u003cstrong\u003edenied\u003c/strong\u003e, Google\u0027s advertising tags and pixels cannot read or write first-party cookies, and third-party cookies are only used for spam and fraud detection. No new advertising cookies will be created, and existing ones cannot be accessed. Requests use a different domain to prevent third-party cookies from being sent in headers. Google Analytics won’t interact with Google Ads cookies, and Google signals won’t collect data. Ad-click identifiers (e.g., GCLID/DCLID) are redacted in Google Ads and used only for approximate traffic measurement in Google Analytics. IP addresses determine the country but are not logged or stored. \u003ca href\u003d\"https://support.google.com/analytics/answer/9976101#behavior\"\u003eMore information\u003c/a\u003e."
              },
              {
                "type": "SELECT",
                "name": "analytics_storage",
                "displayName": "analytics_storage",
                "macrosInSelect": true,
                "selectItems": [
                  {
                    "value": "granted",
                    "displayValue": "granted"
                  },
                  {
                    "value": "denied",
                    "displayValue": "denied"
                  },
                  {
                    "value": "notset",
                    "displayValue": "Not set"
                  }
                ],
                "simpleValueType": true,
                "defaultValue": "denied",
                "help": "If set to \u003cstrong\u003edenied\u003c/strong\u003e, Google Analytics tags won’t read or write analytics cookies, and data sent to Google Analytics won’t use persistent cookie identifiers, as they reset on each page load. Cookieless pings will be used for measurement, with Google Analytics 4 leveraging them for modelling if advanced Consent Mode is enabled. \u003ca href\u003d\"https://support.google.com/analytics/answer/9976101#behavior\"\u003eMore information\u003c/a\u003e."
              },
              {
                "type": "SELECT",
                "name": "ad_user_data",
                "displayName": "ad_user_data",
                "macrosInSelect": true,
                "selectItems": [
                  {
                    "value": "granted",
                    "displayValue": "granted"
                  },
                  {
                    "value": "denied",
                    "displayValue": "denied"
                  },
                  {
                    "value": "notset",
                    "displayValue": "Not set"
                  }
                ],
                "simpleValueType": true,
                "defaultValue": "denied",
                "help": "If set to \u003cstrong\u003edenied\u003c/strong\u003e, user data cannot be used for audience building in Google\u0027s advertising solutions. Conversion pings will be sent as cookieless pings, and multiple cookies will be restricted. Note: Both ad_user_data and ad_personalization must be granted to enable personalized advertising. \u003ca href\u003d\"https://support.google.com/tagmanager/answer/13802165?hl\u003den\"\u003eMore information\u003c/a\u003e."
              },
              {
                "type": "SELECT",
                "name": "ad_personalization",
                "displayName": "ad_personalization",
                "macrosInSelect": true,
                "selectItems": [
                  {
                    "value": "granted",
                    "displayValue": "granted"
                  },
                  {
                    "value": "denied",
                    "displayValue": "denied"
                  },
                  {
                    "value": "notset",
                    "displayValue": "Not set"
                  }
                ],
                "simpleValueType": true,
                "defaultValue": "denied",
                "help": "If set to \u003cstrong\u003edenied\u003c/strong\u003e, data collected on this website will not be used for remarketing in Google\u0027s advertising solutions. Personalized advertising, including remarketing in Google Ads, Display \u0026 Video 360, and Search Ads 360, will be disabled. \u003ca href\u003d\"https://support.google.com/tagmanager/answer/13802165?hl\u003den\"\u003eMore information\u003c/a\u003e."
              }
            ],
            "help": "These parameters are required for Google services."
          },
          {
            "type": "GROUP",
            "name": "optional",
            "displayName": "Optional parameters for Google Consent Mode",
            "groupStyle": "NO_ZIPPY",
            "subParams": [
              {
                "type": "SELECT",
                "name": "personalization_storage",
                "displayName": "personalization_storage",
                "macrosInSelect": true,
                "selectItems": [
                  {
                    "value": "granted",
                    "displayValue": "granted"
                  },
                  {
                    "value": "denied",
                    "displayValue": "denied"
                  },
                  {
                    "value": "notset",
                    "displayValue": "Not set"
                  }
                ],
                "simpleValueType": true,
                "defaultValue": "denied",
                "help": "If set to \u003cstrong\u003edenied\u003c/strong\u003e, data collected on this website will not be used for storage related to personalisation, such as video recommendations. \u003ca href\u003d\"https://developers.google.com/tag-platform/security/concepts/consent-mode\"\u003eMore information\u003c/a\u003e."
              },
              {
                "type": "SELECT",
                "name": "functionality_storage",
                "displayName": "functionality_storage",
                "macrosInSelect": true,
                "selectItems": [
                  {
                    "value": "granted",
                    "displayValue": "granted"
                  },
                  {
                    "value": "denied",
                    "displayValue": "denied"
                  },
                  {
                    "value": "notset",
                    "displayValue": "Not set"
                  }
                ],
                "simpleValueType": true,
                "defaultValue": "denied",
                "help": "If set to \u003cstrong\u003edenied\u003c/strong\u003e, data collected on this website will not be used for storage that supports website or app functionality, such as language settings. \u003ca href\u003d\"https://developers.google.com/tag-platform/security/concepts/consent-mode\"\u003eMore information\u003c/a\u003e."
              },
              {
                "type": "SELECT",
                "name": "security_storage",
                "displayName": "security_storage",
                "macrosInSelect": true,
                "selectItems": [
                  {
                    "value": "granted",
                    "displayValue": "granted"
                  },
                  {
                    "value": "denied",
                    "displayValue": "denied"
                  },
                  {
                    "value": "notset",
                    "displayValue": "Not set"
                  }
                ],
                "simpleValueType": true,
                "defaultValue": "denied",
                "help": "If set to \u003cstrong\u003edenied\u003c/strong\u003e, data collected on this website will not be used for storage related to security, including authentication, fraud prevention, and user protection. \u003ca href\u003d\"https://developers.google.com/tag-platform/security/concepts/consent-mode\"\u003eMore information\u003c/a\u003e."
              }
            ]
          }
        ],
        "enablingConditions": [
          {
            "paramName": "GoogleConsentModeDefaultState",
            "paramValue": "manual",
            "type": "EQUALS"
          }
        ],
        "help": "This lets you define each default state parameter value by yourself."
      },
      {
        "type": "GROUP",
        "name": "GoogleConsentModeOtherSettings",
        "displayName": "Other Settings for Google Consent Mode",
        "groupStyle": "ZIPPY_CLOSED",
        "subParams": [
          {
            "type": "TEXT",
            "name": "waitForUpdate",
            "displayName": "Wait for update",
            "simpleValueType": true,
            "defaultValue": 2000,
            "help": "Set how many miliseconds to wait before firing tags waiting for consent.",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              },
              {
                "type": "NON_NEGATIVE_NUMBER"
              }
            ],
            "valueUnit": "miliseconds"
          },
          {
            "type": "CHECKBOX",
            "name": "url_passthrough",
            "checkboxText": "Enable url_passthrough",
            "simpleValueType": true,
            "help": "Check this box to allow internal links to pass advertising identifiers (\u003cstrong\u003egclid\u003c/strong\u003e, \u003cstrong\u003edclid\u003c/strong\u003e, \u003cstrong\u003egclsrc\u003c/strong\u003e, \u003cstrong\u003e_gl\u003c/strong\u003e, \u003cstrong\u003ewbraid\u003c/strong\u003e, \u003cstrong\u003egbraid\u003c/strong\u003e, etc.) in the URL while awaiting user consent. \u003ca href\u003d\"https://developers.google.com/tag-platform/security/guides/consent#passthroughs\"\u003eMore information\u003c/a\u003e."
          },
          {
            "type": "CHECKBOX",
            "name": "ads_data_redaction",
            "checkboxText": "Enable ads_data_redaction",
            "simpleValueType": true,
            "help": "If you check this box and ad_storage consent is \u003cstrong\u003edenied\u003c/strong\u003e, Google\u0027s advertising tags will remove all advertising identifiers from requests, and traffic will be routed through cookieless domains. No new advertising cookies will be set, and third-party cookies from google.com and doubleclick.net will only be used for spam and fraud prevention. Data sent to Google will still include the full page URL, including ad click information in URL parameters.  \u003ca href\u003d\"https://developers.google.com/tag-platform/security/guides/consent?consentmode\u003dadvanced#redact_ads_data\"\u003eMore information\u003c/a\u003e."
          },
          {
            "type": "CHECKBOX",
            "name": "pushEventToDataLayer",
            "checkboxText": "Push \"consent_default\" event with parameters and values to the dataLayer",
            "simpleValueType": true,
            "help": "If this is checked, the following \u003cstrong\u003eevent: \u0027consent_default\u0027\u003c/strong\u003e will be pushed to the dataLayer, together with all the consent states."
          }
        ],
        "enablingConditions": [
          {
            "paramName": "EnableGoogleConsentMode",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "MicrosoftConsentModeGroup",
    "displayName": "Microsoft Consent Mode for Conseno",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "EnableMicrosoftConsentMode",
        "checkboxText": "Enable Microsoft Consent Mode",
        "simpleValueType": true,
        "defaultValue": true,
        "displayName": "Choose to either enable or disable Microsoft Consent Mode:",
        "help": "Enable Microsoft Consent Mode if one or more of your tags in GTM rely on Microsoft Consent Mode. If this box is checked, Microsoft Consent Mode will be enabled, and Conseno will automatically take into account your visitors\u0027 consent and either activate or block these tags. If this box is unchecked, Microsoft Consent Mode will be disabled.",
        "alwaysInSummary": true
      },
      {
        "type": "SELECT",
        "name": "MicrosoftConsentModeDefaultState",
        "displayName": "Choose the default consent state for Google Consent Mode:",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "automatic",
            "displayValue": "Set the default consent state automatically"
          },
          {
            "value": "manual",
            "displayValue": "Set the default consent state via GTM"
          }
        ],
        "simpleValueType": true,
        "subParams": [],
        "enablingConditions": [
          {
            "paramName": "EnableMicrosoftConsentMode",
            "paramValue": true,
            "type": "EQUALS"
          }
        ],
        "defaultValue": "automatic",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "MicrosoftSetAutomaticallyLabel",
        "displayName": "\u003cstrong\u003eClarification:\u003c/strong\u003e if you choose the \"Set the default consent state automatically\" option, the default consent state signals will be \u0027denied\u0027 by default. For more information about this option, please refer to the official Conseno documentation.",
        "enablingConditions": [
          {
            "paramName": "MicrosoftConsentModeDefaultState",
            "paramValue": "automatic",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "GROUP",
        "name": "MicrosoftsetViaGTMGroup",
        "displayName": "Set the default consent state parameter values via GTM",
        "groupStyle": "ZIPPY_OPEN",
        "subParams": [
          {
            "type": "GROUP",
            "name": "microsoft_required",
            "displayName": "Required parameters for Microsoft Consent Mode",
            "groupStyle": "NO_ZIPPY",
            "subParams": [
              {
                "type": "SELECT",
                "name": "microsoft_ad_storage",
                "displayName": "ad_storage",
                "macrosInSelect": true,
                "selectItems": [
                  {
                    "value": "granted",
                    "displayValue": "granted"
                  },
                  {
                    "value": "denied",
                    "displayValue": "denied"
                  },
                  {
                    "value": "notset",
                    "displayValue": "Not set"
                  }
                ],
                "simpleValueType": true,
                "defaultValue": "denied",
                "help": "If set to \u003cstrong\u003edenied\u003c/strong\u003e, Microsoft\u0027s advertising tags and pixels will not be able to read or write first-party cookies. \u003ca href\u003d\"https://learn.microsoft.com/en-us/xandr/invest/set-up-consent-mode-in-universal-pixel\"\u003eMore information\u003c/a\u003e."
              }
            ],
            "help": "These parameters are required for Microsoft services."
          }
        ],
        "enablingConditions": [
          {
            "paramName": "MicrosoftConsentModeDefaultState",
            "paramValue": "manual",
            "type": "EQUALS"
          }
        ],
        "help": "This lets you define each default state parameter value by yourself."
      },
      {
        "type": "GROUP",
        "name": "MicrosoftConsentModeOtherSettings",
        "displayName": "Other Settings for Microsoft Consent Mode",
        "groupStyle": "ZIPPY_CLOSED",
        "subParams": [
          {
            "type": "TEXT",
            "name": "MicrosoftWaitForUpdate",
            "displayName": "Wait for update",
            "simpleValueType": true,
            "defaultValue": 2000,
            "help": "Set how many miliseconds to wait before firing Microsoft tags waiting for consent.",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              },
              {
                "type": "NON_NEGATIVE_NUMBER"
              }
            ],
            "valueUnit": "miliseconds"
          }
        ],
        "enablingConditions": [
          {
            "paramName": "EnableMicrosoftConsentMode",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const injectScript = require('injectScript');
const log = require('logToConsole');
const encodeUriComponent = require('encodeUriComponent');
const queryPermission = require('queryPermission');
const setInWindow = require('setInWindow');
const copyFromWindow = require('copyFromWindow');
const setDefaultConsentState = require('setDefaultConsentState');
const updateConsentState = require('updateConsentState');
const gtagSet = require('gtagSet');
const makeNumber = require('makeNumber');
const makeTableMap = require('makeTableMap');
const dataLayerPush = require('createQueue')('dataLayer');
const getCookieValues = require('getCookieValues');
const JSON = require('JSON');

// Additional Microsoft Consent Mode function
const uetQueue = require('createQueue')('uetq');

const installationMethodRadio = data.installationMethodRadio;
const conseno_id = data.conseno_id;
const consentBannerLanguage = data.consentBannerLanguage;
const setLanguageByGtmVariable = data.setLanguageByGtmVariable;
const conseno_window = copyFromWindow('conseno');
let script_url;
const EnableGoogleConsentMode = data.EnableGoogleConsentMode;
const EnableMicrosoftConsentMode = data.EnableMicrosoftConsentMode;
const consenoCookie = 'conseno_consent';
const eeaRegions = [
  "AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR",
  "DE","GR","HU","IE","IT","LV","LT","LU","MT","NL",
  "PL","PT","RO","SK","SI","ES","SE","NO","IS","LI"
];

// Identify and prevent duplicate implementations
if (installationMethodRadio === 'gtm') {
  if (conseno_id) {
    if (typeof conseno_window === 'undefined') {
      script_url = 'https://static.conseno.com/main/' + encodeUriComponent(conseno_id) + '/main.js?code_implementation=gtm';
      setInWindow('conseno_gtm', { installed_via_gtm: true, installed_via_html: false }, true);
    } else {
      log(
        '%cYour Conseno installation via Google Tag Manager has been deactivated to prevent loading Conseno twice on your website. ' +
        'You need to choose either the HTML header or the GTM installation option, not both. ' +
        'For more details, please contact our support: https://conseno.com/support/',
        'background: red; color: white; font-size: 16px; padding: 5px;'
      );
      setInWindow('conseno_gtm', { installed_via_gtm: true, installed_via_html: true }, true);
    }

    // Define consent banner language if configured via GTM
    if (consentBannerLanguage === 'document') {
      script_url += '&consent_language=document';
    } else if (consentBannerLanguage === 'browser') {
      script_url += '&consent_language=browser';
    } else if (consentBannerLanguage === 'variable') {
      let langValue = (typeof setLanguageByGtmVariable === 'string') ? setLanguageByGtmVariable : '';
      script_url += '&consent_language=' + encodeUriComponent(langValue).toLowerCase();
    }
  }
} else if (installationMethodRadio === 'html') {
  setInWindow('conseno_gtm', {
    installed_via_gtm: false,
    installed_via_html: typeof conseno_window !== 'undefined'
  }, true);
}

// ----------------------
// DEBUG LOGS FOR CONSENT MODE
// ----------------------
function logConsentDetails(title, defaultObj, updateObj, signals, isFirstLog, isLastLog) {
  // Print a dashed line only before the first log section
    log('---------------------------------------------------');

  // Print the title in bold
  log('%c=== ' + title + ' ===', 'font-weight:bold;');

  // For each signal, print bold signal name, then the values
  for (var i = 0; i < signals.length; i++) {
    var s = signals[i];
    var defVal = typeof defaultObj[s] !== 'undefined' ? defaultObj[s] : '-';
    var updVal = typeof updateObj[s] !== 'undefined' ? updateObj[s] : '-';
    log('%c' + s + '%c -> default: ' + defVal + ' | update: ' + updVal,
      'font-weight:bold;', // styling for the signal name
      'font-weight:normal;' // styling for the rest
    );
  }

  // Print a dashed line **only after the last log section**
    log('---------------------------------------------------');
}

// ----------------------
// GOOGLE CONSENT MODE
// ----------------------
if (EnableGoogleConsentMode) {
  // Ensure script_url won't break on append
  if (!script_url) {
    script_url = '';
  } else {
    script_url += '&google_consent_mode=true&google_consent_mode_implementation=gtm';
  }

  const regions = data.GoogleConsentModeRegions;
  const consentApiDefault = setDefaultConsentState;
  const consentApiUpdate = updateConsentState;

  // Build default object
  const defaultSettingsObject = {};

  if (data.ad_storage !== 'notset') defaultSettingsObject.ad_storage = data.ad_storage || 'denied';
  if (data.analytics_storage !== 'notset') defaultSettingsObject.analytics_storage = data.analytics_storage || 'denied';
  if (data.ad_user_data !== 'notset') defaultSettingsObject.ad_user_data = data.ad_user_data || 'denied';
  if (data.ad_personalization !== 'notset') defaultSettingsObject.ad_personalization = data.ad_personalization || 'denied';
  if (data.personalization_storage !== 'notset') defaultSettingsObject.personalization_storage = data.personalization_storage || 'denied';
  if (data.functionality_storage !== 'notset') defaultSettingsObject.functionality_storage = data.functionality_storage || 'denied';
  if (data.security_storage !== 'notset') defaultSettingsObject.security_storage = data.security_storage || 'denied';

  // "default" command settings
  if (makeNumber(data.wait_for_update) > 0) {
    defaultSettingsObject.wait_for_update = makeNumber(data.wait_for_update);
  }

  // Apply region logic only if not 'all'
  if (regions !== 'all') {
    let setRegions = [];
    if (typeof regions === 'string' && regions.length > 0) {
      setRegions = regions.split(',').map(r => r.trim());
    }
    // If 'eea' is included, expand to the full EEA list
    if (setRegions.indexOf('eea') > -1) {
      setRegions = setRegions.concat(eeaRegions);
      setRegions = setRegions.filter((val, idx) => setRegions.indexOf(val) === idx && val !== 'eea');
    }
    defaultSettingsObject.region = setRegions;
  }

  // Set advanced Google-specific settings
  gtagSet({
    'url_passthrough': data.url_passthrough || false,
    'ads_data_redaction': data.ads_data_redaction || false,
    // Example of a developer ID being set
    'developer_id.dYmYzNG': true
  });

  // "default" command
  consentApiDefault(defaultSettingsObject);

  // Optionally push "default" event to dataLayer
  if (data.pushEventToDataLayer) {
    defaultSettingsObject.event = 'consent_default';
    dataLayerPush(defaultSettingsObject);
  }

  // Build update object
  const updateSettingsObject = {
    ad_storage: 'denied',
    analytics_storage: 'denied',
    ad_user_data: 'denied',
    ad_personalization: 'denied',
    personalization_storage: 'denied',
    functionality_storage: 'denied',
    security_storage: 'denied'
  };

  // Check permission and parse the Conseno cookie
  if (queryPermission('get_cookies', consenoCookie) !== false) {
    const cookieArray = getCookieValues(consenoCookie);
    if (cookieArray && cookieArray.length > 0) {
      const conseno_object = JSON.parse(cookieArray[0]);
      if (
        conseno_object &&
        conseno_object.status !== 'ignored' &&
        conseno_object.details &&
        conseno_object.details.length > 0
      ) {
        const details = conseno_object.details;

        // Look at each detail and set relevant fields
        for (let i = 0; i < details.length; i++) {
          const detail = details[i];
          // ADVERTISING
          if (detail.advertising !== undefined) {
            updateSettingsObject.ad_storage = detail.advertising;
            updateSettingsObject.ad_user_data = detail.advertising;
            updateSettingsObject.ad_personalization = detail.advertising;
          }
          // ANALYTICS
          if (detail.analytics !== undefined) {
            updateSettingsObject.analytics_storage = detail.analytics;
          }
          // FUNCTIONAL
          if (detail.functional !== undefined) {
            updateSettingsObject.personalization_storage = detail.functional;
            updateSettingsObject.functionality_storage = detail.functional;
            updateSettingsObject.security_storage = detail.functional;
          }
        }

        // Fallback if they remain 'denied'
        if (updateSettingsObject.ad_storage === 'denied' && data.ad_storage) {
          updateSettingsObject.ad_storage = data.ad_storage;
        }
        if (updateSettingsObject.ad_user_data === 'denied' && data.ad_user_data) {
          updateSettingsObject.ad_user_data = data.ad_user_data;
        }
        if (updateSettingsObject.ad_personalization === 'denied' && data.ad_personalization) {
          updateSettingsObject.ad_personalization = data.ad_personalization;
        }
        if (updateSettingsObject.analytics_storage === 'denied' && data.analytics_storage) {
          updateSettingsObject.analytics_storage = data.analytics_storage;
        }
        if (updateSettingsObject.personalization_storage === 'denied' && data.personalization_storage) {
          updateSettingsObject.personalization_storage = data.personalization_storage;
        }
        if (updateSettingsObject.functionality_storage === 'denied' && data.functionality_storage) {
          updateSettingsObject.functionality_storage = data.functionality_storage;
        }
        if (updateSettingsObject.security_storage === 'denied' && data.security_storage) {
          updateSettingsObject.security_storage = data.security_storage;
        }
      }
    }
  }

  // Log for Google Consent Mode
  const googleSignals = [
    'ad_storage',
    'analytics_storage',
    'ad_user_data',
    'ad_personalization',
    'personalization_storage',
    'functionality_storage',
    'security_storage'
  ];
  logConsentDetails('Google Consent Mode Details', defaultSettingsObject, updateSettingsObject, googleSignals);

  // "update" command
  consentApiUpdate(updateSettingsObject);

  // Optionally push "update" event to dataLayer
  if (data.pushEventToDataLayer) {
    updateSettingsObject.event = 'consent_update';
    dataLayerPush(updateSettingsObject);
  }
}

// ----------------------
// MICROSOFT CONSENT MODE
// ----------------------
if (EnableMicrosoftConsentMode) {
  // "default" command
  const msDefaultObj = {};

  // Only set ad_storage if not 'notset'
  if (data.microsoft_ad_storage !== 'notset') {
    msDefaultObj.ad_storage = data.microsoft_ad_storage || 'denied';
  }
  // Check wait_for_update
  if (makeNumber(data.microsoft_wait_for_update) > 0) {
    msDefaultObj.wait_for_update = makeNumber(data.microsoft_wait_for_update);
  }

  // Issue the default command
  uetQueue('consent', 'default', msDefaultObj);

  // Build update object (default to 'denied')
  const msUpdateObj = {
    ad_storage: 'denied'
  };

  // Same cookie check approach
  if (queryPermission('get_cookies', consenoCookie) !== false) {
    const cookieArray = getCookieValues(consenoCookie);
    if (cookieArray && cookieArray.length > 0) {
      const conseno_object = JSON.parse(cookieArray[0]);
      if (
        conseno_object &&
        conseno_object.status !== 'ignored' &&
        conseno_object.details &&
        conseno_object.details.length > 0
      ) {
        const details = conseno_object.details;
        for (let i = 0; i < details.length; i++) {
          const detail = details[i];
          // For Microsoft, only 'advertising' matters
          if (detail.advertising !== undefined) {
            msUpdateObj.ad_storage = detail.advertising;
          }
        }
      }
    }
  }

  // Log for Microsoft (no wait_for_update in the signals array)
  const microsoftSignals = ['ad_storage'];
  logConsentDetails('Microsoft Consent Mode Details', msDefaultObj, msUpdateObj, microsoftSignals);

  // Issue the update command
  uetQueue('consent', 'update', msUpdateObj);
}

// ----------------------
// INJECT CONSENO SCRIPT
// ----------------------
const onSuccess = () => {
  data.gtmOnSuccess();
};

const onFailure = () => {
  data.gtmOnFailure();
};

if (script_url && queryPermission('inject_script', script_url)) {
  injectScript(script_url, onSuccess, onFailure);
} else {
  data.gtmOnSuccess();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "conseno"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "conseno_gtm"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "dataLayer"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "uetq"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://static.conseno.com/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "write_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "url_passthrough"
              },
              {
                "type": 1,
                "string": "ads_data_redaction"
              },
              {
                "type": 1,
                "string": "developer_id.dYmYzNG"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_consent",
        "versionId": "1"
      },
      "param": [
        {
          "key": "consentTypes",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analytics_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_user_data"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_personalization"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "personalization_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "functionality_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "security_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "conseno_consent"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 08/07/2024, 16:09:22


